<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>GasBack Lite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://terminal.jup.ag/main-v2.js"></script>
  <style>
    body {
      margin: 0;
      background: #0b0f19;
      color: #fff;
      font-family: system-ui;
    }
    .wrap {
      max-width: 960px;
      margin: 24px auto;
      padding: 16px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .btn {
      background: #1b2a4d;
      border: 1px solid #223055;
      border-radius: 10px;
      padding: 12px 20px;
      cursor: pointer;
      color: white;
      font-weight: bold;
      font-size: 16px;
      transition: background 0.3s;
    }
    .btn:hover {
      background: #2a3a6d;
    }
    .pill {
      background: #141a2a;
      border: 1px solid #223055;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
    }
    .info-section {
      background: #141a2a;
      border: 1px solid #223055;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
    }
    .info-section h2 {
      color: #f59e0b;
      margin-top: 0;
    }
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .info-card {
      background: #1b2a4d;
      border: 1px solid #223055;
      border-radius: 8px;
      padding: 15px;
    }
    .instructions {
      background: #1b2a4d;
      border: 1px solid #223055;
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div><strong>GasBack Lite</strong> — <span id="pair">…</span></div>
      <div class="pill" id="cfg">slip: –, fee: – bps</div>
    </div>
    
    <div class="instructions">
      <h3>Comment utiliser GasBack Lite</h3>
      <ol>
        <li>Cliquez sur le bouton "Open Token Swap" ci-dessous</li>
        <li>Effectuez votre échange de tokens dans le widget</li>
        <li>Fermez le widget pour revenir à cette page</li>
        <li>Consultez les informations ci-dessous pour comprendre le fonctionnement</li>
      </ol>
    </div>
    
    <div style="text-align: center; margin: 30px 0;">
      <button class="btn" id="open">
        Open Token Swap
      </button>
      <div style="margin-top: 15px; opacity:.75;font-size:12px">
        Up to 80% fee cashback on your wallet
      </div>
    </div>
    
    <div class="info-section">
      <h2>How GasBack Works</h2>
      <div class="info-grid">
        <div class="info-card">
          <h3>1. Swap Tokens</h3>
          <p>Use our integrated Jupiter swap interface to exchange any SPL tokens on Solana.</p>
        </div>
        <div class="info-card">
          <h3>2. Earn Cashback</h3>
          <p>Get up to 80% fee cashback on your wallet based on your GASD token holdings.</p>
        </div>
        <div class="info-card">
          <h3>3. Hold GASD</h3>
          <p>Higher GASD holdings mean higher cashback percentages on your trading fees.</p>
        </div>
      </div>
    </div>
    
    <div class="info-section">
      <h2>FAQ</h2>
      <div class="info-grid">
        <div class="info-card">
          <h3>Fermeture du widget</h3>
          <p>Pour fermer le widget d'échange, cliquez sur le bouton "X" en haut à droite du widget ou appuyez sur la touche Échap.</p>
        </div>
        <div class="info-card">
          <h3>Problèmes d'affichage</h3>
          <p>Si le widget ne s'affiche pas, désactivez votre bloqueur de publicité/contenu et rechargez la page.</p>
        </div>
        <div class="info-card">
          <h3>Cashback</h3>
          <p>Les remboursements sont calculés chaque semaine et versés manuellement en USDC.</p>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const qs = new URLSearchParams(location.search);
  const inMint  = qs.get("in")  || "So11111111111111111111111111111111111111112"; // SOL
  const outMint = qs.get("out") || "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"; // USDC
  const amt     = qs.get("amt") || "0.10";
  const slip    = parseInt(qs.get("slip") || "50",10);
  const feeBps  = parseInt(qs.get("feeBps")|| "10",10);

  document.getElementById("pair").textContent = short(inMint)+" → "+short(outMint);
  document.getElementById("cfg").textContent  = `slip: ${slip} bps, fee: ${feeBps} bps`;

  // Renseigne TON ATA USDC pour encaisser des fees :
  const FEE_ACCOUNTS = {
    "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v": "Az9kgSbqq72dPTUKtMuFEp1qQhqi3gUobysNFNQp9K78"
  };

  // RPC public fiable
  const endpoint = "https://solana-rpc.publicnode.com";

  // Vérifier si le script Jupiter est chargé
  if (!window.Jupiter) { 
    // Tenter de recharger le script
    const script = document.createElement('script');
    script.src = "https://terminal.jup.ag/main-v2.js";
    script.onload = function() {
      initJupiter();
    };
    document.head.appendChild(script);
  } else {
    initJupiter();
  }

  function initJupiter() {
    if (!window.Jupiter) { 
      document.getElementById("open").innerHTML = "Erreur: Widget non disponible";
      return; 
    }

    window.Jupiter.init({
      displayMode: "modal",
      integrated: false,
      endpoint,
      defaultInputMint: inMint,
      defaultOutputMint: outMint,
      defaultInputAmount: amt.toString(),
      slippageBps: slip,
      platformFeeAndAccounts: { 
        feeBps: 10, 
        feeAccounts: FEE_ACCOUNTS 
      },
      referral: {
        ref: "www.whtg1.com"
      }
    });

    document.getElementById("open").onclick = () => {
      window.Jupiter.toggle();
    };
  }

  function short(x){ return x.slice(0,4)+"…"+x.slice(-4); }
})();
</script>
</body>
</html>