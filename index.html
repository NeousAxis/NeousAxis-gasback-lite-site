<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>GasBack Lite</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://terminal.jup.ag/main-v2.js"></script>
    <style>
        body {
            margin: 0;
            background: #0b0f19;
            color: #fff;
            font-family: system-ui;
        }
        .wrap {
            max-width: 960px;
            margin: 24px auto;
            padding: 16px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .pill {
            background: #141a2a;
            border: 1px solid #223055;
            border-radius: 999px;
            padding: 6px 10px;
            font-size: 12px;
        }
        #jupiter-terminal {
            height: 640px;
            border: 1px solid #223055;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="wrap">
        <div class="header">
            <div><strong>GasBack Lite</strong> — <span id="pair">…</span></div>
            <div class="pill" id="cfg">slip: –, fee: – bps</div>
        </div>
        <div id="jupiter-terminal"></div>
    </div>

    <script>
    (function(){
        // Initialisation du widget Jupiter
        function initJupiter() {
            const qs = new URLSearchParams(location.search);
            const inMint  = qs.get("in")  || "So11111111111111111111111111111111111111112";
            const outMint = qs.get("out") || "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v";
            const amt     = qs.get("amt") || "0.10";
            const slip    = parseInt(qs.get("slip") || "50",10);
            const feeBps  = parseInt(qs.get("feeBps")|| "10",10);

            document.getElementById("pair").textContent = short(inMint)+" → "+short(outMint);
            document.getElementById("cfg").textContent  = `slip: ${slip} bps, fee: ${feeBps} bps`;

            const FEE_ACCOUNTS = {
                "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v": "Az9kgSbqq72dPTUKtMuFEp1qQhqi3gUobysNFNQp9K78"
            };

            const endpoint = "https://solana-rpc.publicnode.com";

            if (!window.Jupiter) { 
                alert("Jupiter bloqué. Désactive bloqueurs et recharge."); 
                return; 
            }

            window.Jupiter.init({
                container: document.getElementById("jupiter-terminal"),
                containerStyles: { height: "640px" },
                displayMode: "integrated",
                integrated: true,
                endpoint,
                defaultInputMint: inMint,
                defaultOutputMint: outMint,
                defaultInputAmount: amt.toString(),
                slippageBps: slip,
                platformFeeAndAccounts: { 
                    feeBps: 10, 
                    feeAccounts: FEE_ACCOUNTS 
                },
                referral: {
                    ref: "www.whtg1.com"
                }
            });
        }

        function short(x){ return x.slice(0,4)+"…"+x.slice(-4); }
        
        // Initialiser Jupiter quand la page est chargée
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initJupiter);
        } else {
            initJupiter();
        }
    })();
    </script>
</body>
</html>