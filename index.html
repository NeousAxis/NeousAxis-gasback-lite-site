<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>GasBack Lite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://terminal.jup.ag/main-v2.js"></script>
  <style>
    body {
      margin: 0;
      background: #0b0f19;
      color: #fff;
      font-family: system-ui;
    }
    .wrap {
      max-width: 960px;
      margin: 24px auto;
      padding: 16px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .pill {
      background: #141a2a;
      border: 1px solid #223055;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
    }
    #jupiter-terminal {
      width: 100%;
      height: 600px;
      border: 1px solid #223055;
      border-radius: 10px;
      margin: 20px 0;
    }
    .info-section {
      background: #141a2a;
      border: 1px solid #223055;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
    }
    .info-section h2 {
      color: #f59e0b;
      margin-top: 0;
    }
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .info-card {
      background: #1b2a4d;
      border: 1px solid #223055;
      border-radius: 8px;
      padding: 15px;
    }
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 600px;
      background: #141a2a;
      border: 1px solid #223055;
      border-radius: 10px;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div><strong>GasBack Lite</strong> — <span id="pair">…</span></div>
      <div class="pill" id="cfg">slip: –, fee: – bps</div>
    </div>
    
    <div id="loading" class="loading">
      <div>Chargement du widget d'échange...</div>
    </div>
    <div id="jupiter-terminal" style="display: none;"></div>
    
    <div class="info-section">
      <h2>How GasBack Works</h2>
      <div class="info-grid">
        <div class="info-card">
          <h3>1. Swap Tokens</h3>
          <p>Use our integrated Jupiter swap interface to exchange any SPL tokens on Solana.</p>
        </div>
        <div class="info-card">
          <h3>2. Earn Cashback</h3>
          <p>Get up to 80% fee cashback on your wallet based on your GASD token holdings.</p>
        </div>
        <div class="info-card">
          <h3>3. Hold GASD</h3>
          <p>Higher GASD holdings mean higher cashback percentages on your trading fees.</p>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const qs = new URLSearchParams(location.search);
  const inMint  = qs.get("in")  || "So11111111111111111111111111111111111111112"; // SOL
  const outMint = qs.get("out") || "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"; // USDC
  const amt     = qs.get("amt") || "0.10";
  const slip    = parseInt(qs.get("slip") || "50",10);
  const feeBps  = parseInt(qs.get("feeBps")|| "10",10);

  document.getElementById("pair").textContent = short(inMint)+" → "+short(outMint);
  document.getElementById("cfg").textContent  = `slip: ${slip} bps, fee: ${feeBps} bps`;

  // Renseigne TON ATA USDC pour encaisser des fees :
  const FEE_ACCOUNTS = {
    "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v": "Az9kgSbqq72dPTUKtMuFEp1qQhqi3gUobysNFNQp9K78"
  };

  // RPC public fiable
  const endpoint = "https://solana-rpc.publicnode.com";

  // Attendre que le script Jupiter soit chargé
  const checkJupiter = setInterval(() => {
    if (window.Jupiter) {
      clearInterval(checkJupiter);
      initJupiter();
    }
  }, 100);

  function initJupiter() {
    if (!window.Jupiter) { 
      document.getElementById("loading").innerHTML = "<p>Erreur: Widget Jupiter non chargé. Veuillez désactiver les bloqueurs de contenu et recharger la page.</p>";
      return; 
    }

    try {
      window.Jupiter.init({
        container: document.getElementById("jupiter-terminal"),
        displayMode: "integrated",
        integrated: true,
        endpoint,
        defaultInputMint: inMint,
        defaultOutputMint: outMint,
        defaultInputAmount: amt.toString(),
        slippageBps: slip,
        platformFeeAndAccounts: { 
          feeBps: 10, 
          feeAccounts: FEE_ACCOUNTS 
        },
        referral: {
          ref: "www.whtg1.com"
        }
      });

      // Cacher le loader et afficher le widget
      document.getElementById("loading").style.display = "none";
      document.getElementById("jupiter-terminal").style.display = "block";
    } catch (error) {
      document.getElementById("loading").innerHTML = "<p>Erreur lors de l'initialisation du widget: " + error.message + "</p>";
    }
  }

  function short(x){ return x.slice(0,4)+"…"+x.slice(-4); }
})();
</script>
</body>
</html>