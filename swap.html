<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>GasBack Lite — Swap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://terminal.jup.ag/main-v2.js"></script>
  <style>
    body{font-family:system-ui;margin:0;background:#0b0f19;color:#fff}
    .wrap{max-width:960px;margin:24px auto;padding:16px}
    .row{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .pill{background:#141a2a;border:1px solid #223055;border-radius:999px;padding:6px 10px;font-size:12px}
    .btn{background:#1b2a4d;border:1px solid #223055;border-radius:10px;padding:10px 14px;cursor:pointer}
    a{color:#9fc3ff;text-decoration:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="row">
      <div><strong>GasBack Lite</strong> — <span id="pair">…</span></div>
      <div class="pill" id="cfg">slip: –, fee: – bps</div>
    </div>
    <div class="row">
      <button class="btn" id="open">Open Swap</button>
      <div style="opacity:.75;font-size:12px">Tip: URL params: <code>?in=…&out=…&amt=0.5&slip=75&feeBps=10</code></div>
    </div>
  </div>

<script>
(function(){
  const qs = new URLSearchParams(location.search);
  const inMint  = qs.get("in")  || "So11111111111111111111111111111111111111112"; // SOL
  const outMint = qs.get("out") || "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"; // USDC
  const amt     = qs.get("amt") || "0.10";
  const slip    = parseInt(qs.get("slip") || "50",10);
  const feeBps  = parseInt(qs.get("feeBps")|| "10",10);

  document.getElementById("pair").textContent = short(inMint)+" → "+short(outMint);
  document.getElementById("cfg").textContent  = `slip: ${slip} bps, fee: ${feeBps} bps`;

  // ⚠️ Pour encaisser les fees, mets ton ATA USDC ici (laisse vide pour tester l’UI)
  const FEE_ACCOUNTS = {
    // "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v": "TON_ATA_USDC_ICI"
  };

  if (!window.Jupiter) {
    alert("Le script Jupiter ne s'est pas chargé. Désactive adblock/extension et recharge.");
    return;
  }

  window.Jupiter.init({
    // MODE MODAL → robuste (pas de container intégré)
    displayMode: "modal",
    integrated: false,
    endpoint: "https://api.mainnet-beta.solana.com",
    defaultInputMint: inMint,
    defaultOutputMint: outMint,
    defaultInputAmount: amt.toString(),
    slippageBps: slip,
    platformFeeAndAccounts: { feeBps, feeAccounts: FEE_ACCOUNTS }
  });

  document.getElementById("open").onclick = () => window.Jupiter.toggle();

  function short(x){ return x.slice(0,4)+"…"+x.slice(-4); }
})();
</script>
</body>
</html>
