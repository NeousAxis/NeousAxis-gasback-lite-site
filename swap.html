<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>GasBack Lite — Swap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Jupiter Terminal -->
  <script src="https://terminal.jup.ag/main-v2.js"></script>
  <style>
    body{font-family:system-ui;margin:0;background:#0b0f19;color:#fff}
    .wrap{max-width:900px;margin:24px auto;padding:16px}
    .bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .pill{background:#141a2a;border:1px solid #223055;border-radius:999px;padding:6px 10px;font-size:12px}
    #t{height:560px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="bar">
      <div><strong>GasBack Lite</strong> — <span id="pair">…</span></div>
      <div class="pill" id="cfg">slip: –, fee: – bps</div>
    </div>
    <div id="t"></div>
  </div>

<script>
(function(){
  const qs = new URLSearchParams(location.search);
  const inMint  = qs.get("in")  || "So11111111111111111111111111111111111111112"; // SOL
  const outMint = qs.get("out") || "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"; // USDC
  const amt     = qs.get("amt") || "0.10"; // quantité "humaine" du token IN
  const slip    = parseInt(qs.get("slip") || "50", 10);  // 50 bps = 0.5%
  const feeBps  = parseInt(qs.get("feeBps") || "10", 10); // 10 bps = 0.1%

  document.getElementById("pair").textContent = short(inMint)+" → "+short(outMint);
  document.getElementById("cfg").textContent  = `slip: ${slip} bps, fee: ${feeBps} bps`;

  // ⚠️ Pour ENCaisser réellement les fees, il faut déclarer vos feeAccounts (ATA par mint).
  // Pour démarrer sans encaissement (tests), laissez feeAccounts: {}.
  window.Jupiter.init({
    container: document.getElementById("t"),
    displayMode: "integrated",
    integrated: true,
    endpoint: "https://api.mainnet-beta.solana.com",
    defaultInputMint: inMint,
    defaultOutputMint: outMint,
    defaultInputAmount: amt.toString(),
    slippageBps: slip,
    platformFeeAndAccounts: {
      feeBps: feeBps,
      feeAccounts: {
        // "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v": "<VOTRE_ATA_USDC>", // à renseigner quand prêt
        // Ajoutez d'autres mints si besoin
      }
    }
  });

  function short(x){ return x.slice(0,4)+"…"+x.slice(-4); }
})();
</script>
</body>
</html>
